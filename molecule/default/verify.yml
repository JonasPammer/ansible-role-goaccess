---
- name: output some generally helpful debug information about the provisioned machine
  hosts: all
  become: true
  gather_facts: true

  tasks:
    - name: debug output machine facts
      ansible.builtin.include_tasks: ../resources/debug.yml

### Actual Role Verification Tasks:
- name: Verify
  hosts: all

  tasks:
    - name: Check if 'goaccess --version' works
      ansible.builtin.command: goaccess --version
      changed_when: false

    - name: contact localhost to get a apache2 access.log going
      ansible.builtin.uri:
        url: "http://localhost"
      changed_when: false

    - name: stat real time html file
      ansible.builtin.stat:
        path: "/var/www/html/{{ goaccess_systemd_name }}.html" # as per default
      register: goaccess__register_stat_real_time_html

    - name: Check if real time html file exists (should've been generated by systemd service)
      ansible.builtin.assert:
        that:
          - goaccess__register_stat_real_time_html.stat.exists
